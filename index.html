<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>아랍어 타자 연습</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f3f3;
      color: #111;
      display: flex;
      justify-content: center;
      align-items: stretch;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 1100px;
      background: #fff;
      border-radius: 16px;
      padding: 20px 24px 28px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      min-height: 90vh;
    }

    .app-title {
      text-align: center;
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 14px;
    }

    .main-tabs {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 18px;
      flex-wrap: nowrap;
      white-space: nowrap;
    }

    .main-tab-btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #fafafa;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .main-tab-btn.active {
      background: #2196f3;
      border-color: #2196f3;
      color: #fff;
    }

    .tab-section { flex: 1; display: none; }
    .tab-section.active {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      min-height: 0;
    }

    .mode-title {
      text-align: center;
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .top-stats {
      text-align: right;
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 4px;
    }

    .center-wrap {
      max-width: 780px;
      margin: 0 auto;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 14px;
      flex: 1;
    }

    .info-text {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 4px;
    }

    .box {
      background: #f1f1f1;
      border-radius: 10px;
      padding: 12px 14px;
      text-align: center;
    }

    .combined-box { display: flex; flex-direction: column; gap: 6px; }

    .meaning-line { font-size: 1rem; color: #333; }

    .arabic-line {
      font-size: 1.6rem;
      direction: rtl;
      text-align: center;
      color: #111;
      word-wrap: break-word;
      line-height: 1.8;
      white-space: pre-line;
    }

    .typed-display {
      min-height: 34px;
      font-size: 1.6rem;
      direction: rtl;
      text-align: center;
      word-wrap: break-word;
      line-height: 1.8;
    }

    .input-area { margin-top: 6px; }

    .typing-input {
      width: 100%;
      max-width: 640px;
      padding: 10px 12px;
      font-size: 1.2rem;
      direction: rtl;
      text-align: center;
      border-radius: 10px;
      border: 1px solid #ccc;
      outline: none;
    }

    .typing-input:focus {
      border-color: #2196f3;
      box-shadow: 0 0 0 2px rgba(33,150,243,0.12);
    }

    .bottom-row {
      margin-top: 14px;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
      color: #666;
      flex-wrap: wrap;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      background: #2196f3;
      color: #fff;
      cursor: pointer;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    .btn:active { transform: translateY(1px); }

    .correct-char { color: #111; }
    .wrong-char { color: #e53935; }

    .long-selector { display: none; text-align: left; }
    .long-selector.active { display: block; }

    .long-selector-title {
      font-size: 0.9rem;
      color: #444;
      margin-bottom: 4px;
    }

    .long-list {
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #fafafa;
      max-height: 170px;
      overflow-y: auto;
      padding: 4px 0;
    }

    .long-item {
      padding: 6px 10px;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .long-item:hover { background: #e3f2fd; }
    .long-item.selected { background: #bbdefb; font-weight: 600; }

    .game-title {
      text-align: center;
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .game-desc {
      text-align: center;
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 14px;
    }

    .game-inner-tabs {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .game-tab-btn {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #fafafa;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .game-tab-btn.active {
      background: #ff9800;
      border-color: #ff9800;
      color: #fff;
    }

    .game-content { flex: 1; display: none; flex-direction: column; }
    .game-content.active { display: flex; flex-direction: column; }

    .game-center-wrap {
      max-width: 780px;
      margin: 0 auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
      text-align: center;
    }

    .game-typed-display {
      min-height: 30px;
      font-size: 1.5rem;
      direction: rtl;
      text-align: center;
      word-wrap: break-word;
      line-height: 1.7;
    }

    .game-input {
      width: 100%;
      max-width: 640px;
      padding: 8px 11px;
      font-size: 1.1rem;
      direction: rtl;
      text-align: center;
      border-radius: 10px;
      border: 1px solid #ccc;
      outline: none;
    }

    .game-input:focus {
      border-color: #ff9800;
      box-shadow: 0 0 0 2px rgba(255,152,0,0.18);
    }

    .game-top-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 4px;
    }

    .game-stats-row {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 0.9rem;
      color: #666;
      align-items: center;
    }

    .fall-wrapper {
      position: relative;
      height: 320px;
      overflow: hidden;
      border-radius: 12px;
      background: #fafafa;
      margin-top: 6px;
      margin-bottom: 4px;
    }

    .fall-word {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.9rem;
      direction: rtl;
      text-align: center;
      white-space: nowrap;
    }

    .game-arabic-box {
      background: #f1f1f1;
      border-radius: 10px;
      padding: 10px 14px;
      font-size: 1.5rem;
      direction: rtl;
      text-align: center;
      color: #111;
      word-wrap: break-word;
      line-height: 1.7;
      white-space: pre-line;
    }

    .game-meaning-box {
      background: #f1f1f1;
      border-radius: 10px;
      padding: 10px 14px;
      font-size: 0.95rem;
      color: #333;
    }

    @media (max-width: 768px) {
      body { padding: 10px; }
      .container { padding: 16px 16px 22px; min-height: 100vh; }
      .app-title { font-size: 1.4rem; }
      .arabic-line,
      .typed-display,
      .game-arabic-box,
      .game-typed-display,
      .fall-word { font-size: 1.4rem; }
      .typing-input,
      .game-input { font-size: 1.05rem; }
      .fall-wrapper { height: 260px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="app-title">아랍어 타자 연습</h1>

    <div class="main-tabs">
      <button class="main-tab-btn active" data-tab="word">단어</button>
      <button class="main-tab-btn" data-tab="short">문장</button>
      <button class="main-tab-btn" data-tab="long">긴 글</button>
      <button class="main-tab-btn" data-tab="game">게임 모드</button>
    </div>

    <!-- 연습 섹션 -->
    <section class="tab-section active" id="practiceSection">
      <div class="mode-title" id="modeTitle">단어</div>

      <div class="center-wrap">
        <div class="top-stats">
          <span id="practiceTopStats">진행도: 0개 · 정확도: 100% · 0 / 0 글자</span>
        </div>

        <div class="long-selector" id="longSelector">
          <div class="long-selector-title">긴 글 선택</div>
          <div class="long-list" id="longList"></div>
        </div>

        <div>
          <div class="box combined-box">
            <div class="meaning-line" id="practiceMeaning">책상</div>
            <div class="arabic-line" id="practiceTarget">مَكْتَبٌ</div>
          </div>
        </div>

        <div>
          <div class="info-text">타이핑 결과</div>
          <div class="typed-display" id="practiceTypedDisplay"></div>
        </div>

        <div class="input-area">
          <input
            id="practiceInput"
            class="typing-input"
            type="text"
            dir="rtl"
            autocomplete="off"
          />
        </div>

        <div class="bottom-row">
          <button class="btn" id="practiceNextBtn">다음</button>
        </div>
      </div>
    </section>

    <!-- 게임 섹션 -->
    <section class="tab-section" id="gameSection">
      <div class="game-title">게임 모드</div>
      <div class="game-desc">단어 낙하 게임과 문장 타임어택으로 연습해 보세요.</div>

      <div class="game-inner-tabs">
        <button class="game-tab-btn active" data-game="fallWord">단어 게임</button>
        <button class="game-tab-btn" data-game="timeSentence">문장 게임</button>
      </div>

      <!-- 단어 게임 -->
      <div class="game-content active" id="fallWordArea">
        <div class="game-center-wrap">
          <div class="game-top-stats">
            <span id="fallScoreTop">점수: 0</span>
            <span id="fallSpeedInfo">속도: 1.0x</span>
          </div>

          <div class="fall-wrapper" id="fallWrapper"></div>

          <div>
            <div class="info-text">타이핑 결과</div>
            <div class="game-typed-display" id="fallTypedDisplay"></div>
          </div>

          <div class="input-area">
            <input
              id="fallInput"
              class="game-input"
              type="text"
              dir="rtl"
              autocomplete="off"
            />
          </div>

          <div class="game-stats-row">
            <div id="fallStatus">준비 완료</div>
            <div>
              <button class="btn" id="fallStartBtn">게임 시작</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 문장 게임 -->
      <div class="game-content" id="timeSentenceArea">
        <div class="game-center-wrap">
          <div class="game-top-stats">
            <span id="timeLeft">남은 시간: 30초</span>
            <span id="timeScore">완료한 문제: 0개</span>
            <span id="timeAccuracy">정확도: 100%</span>
          </div>

          <div>
            <div class="game-meaning-box" id="timeMeaning">한국어 뜻이 여기에 표시됩니다.</div>
          </div>

          <div>
            <div class="info-text">아랍어</div>
            <div class="game-arabic-box" id="timeTargetDisplay"></div>
          </div>

          <div>
            <div class="info-text">타이핑 결과</div>
            <div class="game-typed-display" id="timeTypedDisplay"></div>
          </div>

          <div class="input-area">
            <input
              id="timeInput"
              class="game-input"
              type="text"
              dir="rtl"
              autocomplete="off"
            />
          </div>

          <div class="game-stats-row">
            <div></div>
            <div>
              <button class="btn" id="timeStartBtn">시작</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // ---------- 공통 유틸 ----------
    function stripDiacritics(str) {
      // 아랍어 모음부호(타쉬킬) 제거
      return str.replace(/[\u0610-\u061A\u064B-\u0652\u0670\u06D6-\u06ED]/g, "");
    }

    function shuffleArray(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // 글자 단위 채색 (모음부호는 무시하고 자음 기준으로 비교)
    function colorizeText(target, typed) {
      const baseTarget = stripDiacritics(target);      // ex) مَكْتَبٌ -> مكتب
      const baseTyped  = stripDiacritics(typed);       // 보통 typed와 동일

      let html = "";
      let correctCount = 0;

      for (let i = 0; i < baseTyped.length; i++) {
        const rawCh   = typed[i] || "";        // 실제 표시용 문자
        const typedCh = baseTyped[i] || "";
        const tgtCh   = baseTarget[i] || "";

        if (!rawCh) continue;

        if (typedCh === tgtCh) {
          html += `<span class="correct-char">${rawCh}</span>`;
          correctCount++;
        } else {
          html += `<span class="wrong-char">${rawCh}</span>`;
        }
      }

      const baseLen = baseTarget.length;
      return { html, correctCount, baseLen, typedLen: baseTyped.length };
    }

    // ---------- 문제 데이터 ----------
    const exercises = [
      // 단어
      { type: "word", meaning: "책상", text: "مَكْتَبٌ" },
{ type: "word", meaning: "학교", text: "مَدْرَسَةٌ" },
{ type: "word", meaning: "친구", text: "صَدِيقٌ" },
{ type: "word", meaning: "물", text: "مَاءٌ" },
{ type: "word", meaning: "집", text: "بَيْتٌ" },
{ type: "word", meaning: "도시", text: "مَدِينَةٌ" },
{ type: "word", meaning: "나라", text: "بَلَدٌ" },
{ type: "word", meaning: "책", text: "كِتَابٌ" },
{ type: "word", meaning: "문", text: "بَابٌ" },
{ type: "word", meaning: "의자", text: "كُرْسِيٌّ" },
{ type: "word", meaning: "침대", text: "سَرِيرٌ" },
{ type: "word", meaning: "음식", text: "طَعَامٌ" },
{ type: "word", meaning: "커피", text: "قَهْوَةٌ" },
{ type: "word", meaning: "차(tea)", text: "شَايٌ" },
{ type: "word", meaning: "사람", text: "إِنْسَانٌ" },
{ type: "word", meaning: "학생", text: "طَالِبٌ" },
{ type: "word", meaning: "선생님", text: "مُعَلِّمٌ" },
{ type: "word", meaning: "가족", text: "أُسْرَةٌ" },
{ type: "word", meaning: "아버지", text: "أَبٌ" },
{ type: "word", meaning: "어머니", text: "أُمٌّ" },
{ type: "word", meaning: "형제", text: "أَخٌ" },
{ type: "word", meaning: "자매", text: "أُخْتٌ" },
{ type: "word", meaning: "태양", text: "شَمْسٌ" },
{ type: "word", meaning: "달", text: "قَمَرٌ" },
{ type: "word", meaning: "바람", text: "رِيحٌ" },
{ type: "word", meaning: "하늘", text: "سَمَاءٌ" },
{ type: "word", meaning: "바다", text: "بَحْرٌ" },
{ type: "word", meaning: "산", text: "جَبَلٌ" },
{ type: "word", meaning: "강", text: "نَهْرٌ" },
{ type: "word", meaning: "길", text: "طَرِيقٌ" },
{ type: "word", meaning: "자동차", text: "سَيَّارَةٌ" },
{ type: "word", meaning: "버스", text: "حَافِلَةٌ" },
{ type: "word", meaning: "비행기", text: "طَائِرَةٌ" },
{ type: "word", meaning: "공항", text: "مَطَارٌ" },
{ type: "word", meaning: "시장", text: "سُوقٌ" },
{ type: "word", meaning: "가게", text: "مَحَلٌّ" },
{ type: "word", meaning: "돈", text: "مَالٌ" },
{ type: "word", meaning: "시간", text: "وَقْتٌ" },
{ type: "word", meaning: "하루", text: "يَوْمٌ" },
{ type: "word", meaning: "밤", text: "لَيْلٌ" },
{ type: "word", meaning: "아침", text: "صَبَاحٌ" },
{ type: "word", meaning: "저녁", text: "مَسَاءٌ" },
{ type: "word", meaning: "음악", text: "مُوسِيقَى" },
{ type: "word", meaning: "사진", text: "صُورَةٌ" },
{ type: "word", meaning: "전화기", text: "هَاتِفٌ" },
{ type: "word", meaning: "컴퓨터", text: "حَاسُوبٌ" },
{ type: "word", meaning: "창문", text: "نَافِذَةٌ" },
{ type: "word", meaning: "꽃", text: "زَهْرَةٌ" },
{ type: "word", meaning: "나무", text: "شَجَرَةٌ" },
{ type: "word", meaning: "새", text: "طَائِرٌ" },
{ type: "word", meaning: "개", text: "كَلْبٌ" },
{ type: "word", meaning: "고양이", text: "قِطٌّ" },
{ type: "word", meaning: "책가방", text: "حَقِيبَةٌ" },
{ type: "word", meaning: "문제", text: "مُشْكِلَةٌ" },
{ type: "word", meaning: "사랑", text: "حُبٌّ" },
{ type: "word", meaning: "평화", text: "سَلَامٌ" },
{ type: "word", meaning: "행복", text: "سَعَادَةٌ" },
      { type: "word", meaning: "문장", text: "جُمْلَةٌ" },
{ type: "word", meaning: "단어", text: "كَلِمَةٌ" },
{ type: "word", meaning: "이름", text: "اِسْمٌ" },
{ type: "word", meaning: "손", text: "يَدٌ" },
{ type: "word", meaning: "눈", text: "عَيْنٌ" },
{ type: "word", meaning: "귀", text: "أُذُنٌ" },
{ type: "word", meaning: "입", text: "فَمٌ" },
{ type: "word", meaning: "머리", text: "رَأْسٌ" },
{ type: "word", meaning: "얼굴", text: "وَجْهٌ" },
{ type: "word", meaning: "몸", text: "جِسْمٌ" },

{ type: "word", meaning: "음료", text: "مَشْرُوبٌ" },
{ type: "word", meaning: "빵", text: "خُبْزٌ" },
{ type: "word", meaning: "과일", text: "فَاكِهَةٌ" },
{ type: "word", meaning: "사과", text: "تُفَّاحَةٌ" },
{ type: "word", meaning: "바나나", text: "مَوْزَةٌ" },
{ type: "word", meaning: "오렌지", text: "بُرْتُقَالَةٌ" },
{ type: "word", meaning: "밥", text: "أَرُزٌّ" },
{ type: "word", meaning: "고기", text: "لَحْمٌ" },
{ type: "word", meaning: "닭고기", text: "دَجَاجٌ" },
{ type: "word", meaning: "생선", text: "سَمَكٌ" },

{ type: "word", meaning: "옷", text: "مَلَابِسُ" },
{ type: "word", meaning: "신발", text: "حِذَاءٌ" },
{ type: "word", meaning: "가방", text: "حَقِيبَةٌ" },
{ type: "word", meaning: "모자", text: "قُبَّعَةٌ" },
{ type: "word", meaning: "시계", text: "سَاعَةٌ" },
{ type: "word", meaning: "열쇠", text: "مِفْتَاحٌ" },
{ type: "word", meaning: "선물", text: "هَدِيَّةٌ" },
{ type: "word", meaning: "약", text: "دَوَاءٌ" },
{ type: "word", meaning: "의사", text: "طَبِيبٌ" },
{ type: "word", meaning: "병원", text: "مُسْتَشْفَى" },
{ type: "word", meaning: "약국", text: "صَيْدَلِيَّةٌ" },
{ type: "word", meaning: "시장", text: "سُوقٌ" },
{ type: "word", meaning: "은행", text: "بَنْكٌ" },
{ type: "word", meaning: "우체국", text: "مَكْتَبُ الْبَرِيدِ" },
{ type: "word", meaning: "도서관", text: "مَكْتَبَةٌ" },
{ type: "word", meaning: "식당", text: "مَطْعَمٌ" },
{ type: "word", meaning: "카페", text: "مَقْهَى" },
{ type: "word", meaning: "호텔", text: "فُنْدُقٌ" },
{ type: "word", meaning: "방", text: "غُرْفَةٌ" },
{ type: "word", meaning: "욕실", text: "حَمَّامٌ" },
{ type: "word", meaning: "비", text: "مَطَرٌ" },
{ type: "word", meaning: "눈(눈송이)", text: "ثَلْجٌ" },
{ type: "word", meaning: "날씨", text: "طَقْسٌ" },
{ type: "word", meaning: "여름", text: "صَيْفٌ" },
{ type: "word", meaning: "겨울", text: "شِتَاءٌ" },
{ type: "word", meaning: "봄", text: "رَبِيعٌ" },
{ type: "word", meaning: "가을", text: "خَرِيفٌ" },
{ type: "word", meaning: "불", text: "نَارٌ" },
{ type: "word", meaning: "빛", text: "ضَوْءٌ" },
{ type: "word", meaning: "그림", text: "رَسْمٌ" },

      
      // 짧은 문장
      { type: "sentence-short", meaning: "만나서 반갑습니다.", text: "تَشَرَّفْتُ بِمَعْرِفَتِكَ." },
       { type: "sentence-short", meaning: "안녕하세요.", text: "السَّلَامُ عَلَيْكُمْ." },
{ type: "sentence-short", meaning: "좋은 아침입니다.", text: "صَبَاحُ الخَيْرِ." },
{ type: "sentence-short", meaning: "좋은 저녁입니다.", text: "مَسَاءُ الخَيْرِ." },
{ type: "sentence-short", meaning: "저는 잘 지내요.", text: "أَنَا بِخَيْرٍ." },
{ type: "sentence-short", meaning: "당신의 이름은 무엇인가요?", text: "مَا اسْمُكَ؟" },
{ type: "sentence-short", meaning: "제 이름은 지훈입니다.", text: "اِسْمِي جِهُون." },
{ type: "sentence-short", meaning: "만나서 반갑습니다.", text: "تَشَرَّفْتُ بِلِقَائِكَ." },
{ type: "sentence-short", meaning: "어디에서 왔나요?", text: "مِنْ أَيْنَ أَنْتَ؟" },
{ type: "sentence-short", meaning: "저는 한국에서 왔어요.", text: "أَنَا مِنْ كُورِيَا." },
{ type: "sentence-short", meaning: "감사합니다.", text: "شُكْرًا جَزِيلًا." },

{ type: "sentence-short", meaning: "죄송합니다.", text: "آسِفٌ." },
{ type: "sentence-short", meaning: "괜찮아요.", text: "لَا بَأْسَ." },
{ type: "sentence-short", meaning: "이것은 얼마인가요?", text: "كَمْ سِعْرُ هَذَا؟" },
{ type: "sentence-short", meaning: "저는 학생입니다.", text: "أَنَا طَالِبٌ." },
{ type: "sentence-short", meaning: "지금 몇 시인가요?", text: "كَمِ السَّاعَةُ الآنَ؟" },
{ type: "sentence-short", meaning: "저는 배고파요.", text: "أَنَا جَائِعٌ." },
{ type: "sentence-short", meaning: "저는 목말라요.", text: "أَنَا عَطْشَانُ." },
{ type: "sentence-short", meaning: "더 천천히 말해 주세요.", text: "تَحَدَّثْ بِبُطْءٍ مِنْ فَضْلِكَ." },
{ type: "sentence-short", meaning: "저는 이해했어요.", text: "فَهِمْتُ." },
{ type: "sentence-short", meaning: "저는 이해하지 못했어요.", text: "لَمْ أَفْهَمْ." },

{ type: "sentence-short", meaning: "하루가 정말 길었어요.", text: "كَانَ الْيَوْمُ طَوِيلًا جِدًّا." },
{ type: "sentence-short", meaning: "날씨가 정말 좋아요.", text: "الجَوُّ جَمِيلٌ جِدًّا." },
{ type: "sentence-short", meaning: "비가 오고 있어요.", text: "إِنَّهُ يَمْطُرُ." },
{ type: "sentence-short", meaning: "저는 여행을 좋아해요.", text: "أُحِبُّ السَّفَرَ." },
{ type: "sentence-short", meaning: "사진 찍어도 될까요?", text: "هَلْ يُمْكِنُنِي أَنْ أُصَوِّرَ؟" },
{ type: "sentence-short", meaning: "도와주셔서 감사합니다.", text: "شُكْرًا عَلَى مُسَاعَدَتِكَ." },
{ type: "sentence-short", meaning: "행운을 빌어요!", text: "حَظًّا سَعِيدًا!" },
{ type: "sentence-short", meaning: "조심히 가세요.", text: "اِذْهَبْ بِالسَّلَامَةِ." },
{ type: "sentence-short", meaning: "곧 다시 만나요.", text: "أَرَاكَ قَرِيبًا." },
{ type: "sentence-short", meaning: "정말 멋져요!", text: "رَائِعٌ جِدًّا!" },

// 속담/표현
{ type: "sentence-short", meaning: "서두르지 않으면 성공한다.", text: "مَنْ جَدَّ وَجَدَ." },
{ type: "sentence-short", meaning: "지식은 빛이다.", text: "الْعِلْمُ نُورٌ." },
{ type: "sentence-short", meaning: "인내는 열쇠이다.", text: "الصَّبْرُ مِفْتَاحُ الْفَرَجِ." },
{ type: "sentence-short", meaning: "손님은 환영받는다.", text: "الضَّيْفُ مَرْحُوبٌ بِهِ." },
{ type: "sentence-short", meaning: "건강은 축복이다.", text: "الصِّحَّةُ نِعْمَةٌ." },
{ type: "sentence-short", meaning: "시간은 금이다.", text: "الوَقْتُ ذَهَبٌ." },
{ type: "sentence-short", meaning: "연습은 완벽을 만든다.", text: "التَّكْرَارُ يُعَلِّمُ الشُّطَّارَ." },
{ type: "sentence-short", meaning: "천천히 가면 안전하다.", text: "فِي التَّأَنِّي السَّلَامَةُ." },
{ type: "sentence-short", meaning: "길은 걷는 사람에게 열려 있다.", text: "الطَّرِيقُ لِمَنْ يَمْشِي." },
{ type: "sentence-short", meaning: "정답보다 진심이 중요하다.", text: "النِّيَّةُ خَيْرٌ مِنَ العَمَلِ." },

      // 긴 글 예시
      {
        type: "sentence-long",
        title: "동화 1",
        meaning: "여름날 학교에 가는 소년의 이야기",
        text:
"فِي يَوْمٍ مِنَ الأَيَّامِ ذَهَبَ وَلَدٌ صَغِيرٌ إِلَى الْمَدْرَسَةِ.\n" +
"كَانَ يَحْمِلُ فِي حَقِيبَتِهِ كِتَابَ الْقِصَصِ الَّذِي يُحِبُّهُ جِدًّا.\n" +
"فِي طَرِيقِهِ قَابَلَ صَدِيقَهُ فِي الْحَيِّ، وَتَحَدَّثَا عَنِ الْأَحْلَامِ وَالْمُسْتَقْبَلِ."
      },
      {
        type: "sentence-long",
        title: "뉴스 1",
        meaning: "아랍어 교육 프로그램 개설에 관한 뉴스",
        text:
"أَعْلَنَتِ الْجَامِعَةُ الْيَوْمَ عَنْ بَرْنَامَجٍ جَدِيدٍ لِتَعْلِيمِ اللُّغَةِ الْعَرَبِيَّةِ.\n" +
"يَهْدِفُ الْبَرْنَامَجُ إِلَى مُسَاعَدَةِ الطُّلَّابِ عَلَى التَّحَدُّثِ وَالْكِتَابَةِ بِطَلَاقَةٍ.\n" +
"سَيَبْدَأُ التَّسْجِيلُ فِي الشَّهْرِ الْمُقْبِلِ وَسَيَكُونُ مَجَّانِيًّا لِجَمِيعِ الطُّلَّابِ."
      }
    ];

    // ---------- 상단 탭 ----------
    const mainTabButtons = document.querySelectorAll(".main-tab-btn");
    const practiceSection = document.getElementById("practiceSection");
    const gameSection = document.getElementById("gameSection");
    let currentMode = "word";

    mainTabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        mainTabButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const tab = btn.dataset.tab;

        if (tab === "game") {
          practiceSection.classList.remove("active");
          gameSection.classList.add("active");
        } else {
          gameSection.classList.remove("active");
          practiceSection.classList.add("active");
          currentMode = tab;
          setupPracticeMode();
        }
      });
    });

    // ---------- 연습 모드 ----------
    const modeTitle = document.getElementById("modeTitle");
    const practiceMeaning = document.getElementById("practiceMeaning");
    const practiceTarget = document.getElementById("practiceTarget");
    const practiceTypedDisplay = document.getElementById("practiceTypedDisplay");
    const practiceInput = document.getElementById("practiceInput");
    const practiceTopStats = document.getElementById("practiceTopStats");
    const longSelector = document.getElementById("longSelector");
    const longListEl = document.getElementById("longList");
    const practiceNextBtn = document.getElementById("practiceNextBtn");

    let practiceList = [];
    let practiceIndex = 0;
    let practiceCurrent = null;

    function updatePracticeTopStats(accuracy, typedLen, totalLen) {
      const progressCount = (practiceList && practiceList.length > 0)
        ? (practiceIndex + 1)
        : 0;
      practiceTopStats.textContent =
        `진행도: ${progressCount}개 · 정확도: ${accuracy}% · ${typedLen} / ${totalLen} 글자`;
    }

    function buildLongList() {
      longListEl.innerHTML = "";
      practiceList.forEach((item, idx) => {
        const div = document.createElement("div");
        div.className = "long-item" + (idx === practiceIndex ? " selected" : "");
        const title = item.title || item.meaning || `긴 글 ${idx + 1}`;
        div.textContent = title;
        div.addEventListener("click", () => {
          practiceIndex = idx;
          loadPracticeItem();
          document.querySelectorAll(".long-item").forEach((el, i) => {
            el.classList.toggle("selected", i === practiceIndex);
          });
        });
        longListEl.appendChild(div);
      });
    }

    function setupPracticeMode() {
      if (currentMode === "word") {
        modeTitle.textContent = "단어";
        practiceList = shuffleArray(exercises.filter(ex => ex.type === "word"));
        longSelector.classList.remove("active");
      } else if (currentMode === "short") {
        modeTitle.textContent = "문장";
        practiceList = shuffleArray(exercises.filter(ex => ex.type === "sentence-short"));
        longSelector.classList.remove("active");
      } else {
        modeTitle.textContent = "긴 글";
        practiceList = shuffleArray(exercises.filter(ex => ex.type === "sentence-long"));
        longSelector.classList.add("active");
        buildLongList();
      }

      if (practiceList.length === 0) {
        practiceMeaning.textContent = "연습할 문장이 없습니다.";
        practiceTarget.textContent = "";
        practiceTypedDisplay.innerHTML = "";
        practiceInput.value = "";
        updatePracticeTopStats(100, 0, 0);
        return;
      }

      practiceIndex = 0;
      loadPracticeItem();
    }

    function loadPracticeItem() {
      practiceCurrent = practiceList[practiceIndex];
      const targetText = practiceCurrent.text || "";

      practiceMeaning.textContent = practiceCurrent.meaning || "";
      practiceTarget.textContent = targetText;
      practiceTypedDisplay.innerHTML = "";
      practiceInput.value = "";

      const baseLen = stripDiacritics(targetText).length;
      updatePracticeTopStats(100, 0, baseLen);

      if (currentMode === "long") {
        document.querySelectorAll(".long-item").forEach((el, i) => {
          el.classList.toggle("selected", i === practiceIndex);
        });
      }

      practiceInput.focus();
    }

    function updatePracticeTyping() {
      if (!practiceCurrent) return;
      const typed = practiceInput.value;
      const target = practiceCurrent.text || "";

      const { html, correctCount, baseLen, typedLen } = colorizeText(target, typed);
      practiceTypedDisplay.innerHTML = html;

      const accuracy = typedLen === 0
        ? 100
        : Math.round((correctCount / baseLen) * 100);

      updatePracticeTopStats(accuracy, typedLen, baseLen);
    }

    practiceInput.addEventListener("input", updatePracticeTyping);// 엔터 키로도 다음 문제로 넘어가기
practiceInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    e.preventDefault();        // 줄바꿈 방지
    practiceNextBtn.click();   // '다음' 버튼 강제로 클릭
  }
});
    practiceNextBtn.addEventListener("click", () => {
      if (practiceList.length === 0) return;
      practiceIndex = (practiceIndex + 1) % practiceList.length;
      loadPracticeItem();
    });

    setupPracticeMode();

    // ---------- 게임 탭 전환 ----------
    const gameTabButtons = document.querySelectorAll(".game-tab-btn");
    const fallWordArea = document.getElementById("fallWordArea");
    const timeSentenceArea = document.getElementById("timeSentenceArea");

    gameTabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        gameTabButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const gameType = btn.dataset.game;

        if (gameType === "fallWord") {
          fallWordArea.classList.add("active");
          timeSentenceArea.classList.remove("active");
        } else {
          timeSentenceArea.classList.add("active");
          fallWordArea.classList.remove("active");
        }
      });
    });

    // ---------- 단어 게임 (위 -> 아래) ----------
    const fallWrapper = document.getElementById("fallWrapper");
    const fallTypedDisplay = document.getElementById("fallTypedDisplay");
    const fallInput = document.getElementById("fallInput");
    const fallScoreTop = document.getElementById("fallScoreTop");
    const fallSpeedInfo = document.getElementById("fallSpeedInfo");
    const fallStatus = document.getElementById("fallStatus");
    const fallStartBtn = document.getElementById("fallStartBtn");

    let fallState = {
      active: false,
      score: 0,
      speed: 1.0,
      timerId: null,
      spawnId: null,
      items: [],
      current: null
    };

    function getRandomWord() {
      const wordList = exercises.filter(ex => ex.type === "word");
      if (wordList.length === 0) return null;
      const idx = Math.floor(Math.random() * wordList.length);
      return wordList[idx];
    }

    function spawnFallWord() {
      if (!fallState.active) return;
      const data = getRandomWord();
      if (!data) return;

      const id = Date.now() + Math.random();

      const el = document.createElement("div");
      el.className = "fall-word";
      el.dataset.id = id;
      el.textContent = data.text;

      let yPx = -40;
      el.style.top = yPx + "px";

      fallWrapper.appendChild(el);

      const item = { id, text: data.text, el, yPx };
      fallState.items.push(item);

      if (!fallState.current) {
        fallState.current = item;
        fallInput.value = "";
        fallTypedDisplay.innerHTML = "";
      }
    }

    function updateFallingPosition() {
      if (!fallState.active) return;
      const wrapperHeight = fallWrapper.clientHeight;

      for (const item of fallState.items) {
        item.yPx += fallState.speed;
        item.el.style.top = item.yPx + "px";

        const bottom = item.yPx + item.el.offsetHeight;
        if (bottom >= wrapperHeight) {
          stopFallGame(false);
          return;
        }
      }
    }

    function startFallGame() {
      if (fallState.active) return;

      fallState.active = true;
      fallState.score = 0;
      fallState.speed = 1.0;
      fallState.items.forEach(i => i.el.remove());
      fallState.items = [];
      fallState.current = null;
      fallWrapper.innerHTML = "";
      fallScoreTop.textContent = "점수: 0";
      fallSpeedInfo.textContent = "속도: 1.0x";
      fallStatus.textContent = "진행 중...";
      fallTypedDisplay.innerHTML = "";
      fallInput.value = "";
      fallInput.focus();

      if (fallState.timerId) clearInterval(fallState.timerId);
      if (fallState.spawnId) clearInterval(fallState.spawnId);

      fallState.timerId = setInterval(updateFallingPosition, 40);
      fallState.spawnId = setInterval(spawnFallWord, 2200);

      spawnFallWord();
    }

    function stopFallGame(cleared) {
      fallState.active = false;
      if (fallState.timerId) {
        clearInterval(fallState.timerId);
        fallState.timerId = null;
      }
      if (fallState.spawnId) {
        clearInterval(fallState.spawnId);
        fallState.spawnId = null;
      }

      if (!cleared) {
        fallStatus.textContent = `게임 오버 · 최종 점수: ${fallState.score}`;
      } else {
        fallStatus.textContent = `게임 종료 · 점수: ${fallState.score}`;
      }
    }

    function handleFallInput() {
      if (!fallState.active || !fallState.current) return;

      const typed = fallInput.value;
      const target = fallState.current.text;
      const { html, correctCount, baseLen } = colorizeText(target, typed);
      fallTypedDisplay.innerHTML = html;

      if (stripDiacritics(typed) === stripDiacritics(target)) {
        fallState.score++;
        fallScoreTop.textContent = `점수: ${fallState.score}`;

        fallState.speed += 0.3;
        fallSpeedInfo.textContent = `속도: ${fallState.speed.toFixed(1)}x`;

        fallState.current.el.remove();
        fallState.items = fallState.items.filter(it => it.id !== fallState.current.id);
        fallState.current = fallState.items[0] || null;

        fallInput.value = "";
        fallTypedDisplay.innerHTML = "";
      }
    }

    fallStartBtn.addEventListener("click", startFallGame);
    fallInput.addEventListener("input", handleFallInput);

    // ---------- 문장 타임어택 ----------
    const timeMeaning = document.getElementById("timeMeaning");
    const timeTargetDisplay = document.getElementById("timeTargetDisplay");
    const timeTypedDisplay = document.getElementById("timeTypedDisplay");
    const timeInput = document.getElementById("timeInput");
    const timeLeftEl = document.getElementById("timeLeft");
    const timeScoreEl = document.getElementById("timeScore");
    const timeAccuracyEl = document.getElementById("timeAccuracy");
    const timeStartBtn = document.getElementById("timeStartBtn");

    let timeState = {
      active: false,
      timeLeft: 30,
      timerId: null,
      score: 0,
      current: null
    };

    function getRandomSentence() {
      const list = exercises.filter(ex =>
        ex.type === "sentence-short" || ex.type === "sentence-long"
      );
      if (list.length === 0) return null;
      const idx = Math.floor(Math.random() * list.length);
      return list[idx];
    }

    function loadTimeQuestion() {
      timeState.current = getRandomSentence();
      if (!timeState.current) return;

      timeMeaning.textContent = timeState.current.meaning || "";
      timeTargetDisplay.textContent = timeState.current.text || "";
      timeTypedDisplay.innerHTML = "";
      timeInput.value = "";
      timeInput.focus();
    }

    function updateTimeTyping() {
      if (!timeState.active || !timeState.current) return;

      const typed = timeInput.value;
      const target = timeState.current.text;
      const { html, correctCount, baseLen, typedLen } = colorizeText(target, typed);
      timeTypedDisplay.innerHTML = html;

      if (stripDiacritics(typed) === stripDiacritics(target)) {
        timeState.score++;
        timeScoreEl.textContent = `완료한 문제: ${timeState.score}개`;
        loadTimeQuestion();
      }

      const accuracy = typedLen === 0
        ? 100
        : Math.round((correctCount / baseLen) * 100);
      timeAccuracyEl.textContent = `정확도: ${accuracy}%`;
    }

    function startTimeAttack() {
      if (timeState.active) return;

      timeState.active = true;
      timeState.timeLeft = 30;
      timeState.score = 0;
      timeScoreEl.textContent = "완료한 문제: 0개";
      timeLeftEl.textContent = "남은 시간: 30초";
      timeAccuracyEl.textContent = "정확도: 100%";
      loadTimeQuestion();

      if (timeState.timerId) clearInterval(timeState.timerId);
      timeState.timerId = setInterval(() => {
        timeState.timeLeft--;
        if (timeState.timeLeft <= 0) {
          timeLeftEl.textContent = "남은 시간: 0초";
          endTimeAttack();
        } else {
          timeLeftEl.textContent = `남은 시간: ${timeState.timeLeft}초`;
        }
      }, 1000);
    }

    function endTimeAttack() {
      timeState.active = false;
      if (timeState.timerId) {
        clearInterval(timeState.timerId);
        timeState.timerId = null;
      }
      timeLeftEl.textContent = `시간 종료 · 최종 점수: ${timeState.score}개`;
    }

    timeStartBtn.addEventListener("click", startTimeAttack);
    timeInput.addEventListener("input", updateTimeTyping);
  </script>
</body>
</html>
